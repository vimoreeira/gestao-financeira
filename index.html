<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Financeiro - Ordem Alfab√©tica</title>
    <style>
        :root {
            --primary: #4a90e2;
            --danger: #e74c3c;
            --success: #2ecc71;
            --dark: #2c3e50;
            --light: #f4f7f6;
            --gray: #95a5a6;
            --purple: #9b59b6;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--light); display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 1100px; }
        
        h2, h3 { color: var(--dark); text-align: center; margin-bottom: 20px; }
        
        .section { margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: flex-end; }
        
        .field-group { display: flex; flex-direction: column; flex: 1; min-width: 130px; }
        label { font-size: 0.75rem; color: var(--gray); margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }

        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; background-color: white; }
        
        #card-name-container, #filter-card-container { display: none; border-left: 3px solid var(--purple); padding-left: 10px; }

        button { border: none; padding: 11px 15px; border-radius: 6px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        #add-btn { background: var(--primary); color: white; width: 100%; font-size: 1rem; margin-top: 10px; }
        #add-btn:hover { background: #357abd; }
        
        .btn-filter { background: var(--dark); color: white; flex: 1; min-width: 100px; }
        .btn-clear { background: var(--gray); color: white; flex: 1; min-width: 100px; }

        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; white-space: nowrap; }
        .cat-badge { background: #ebedef; color: #555; }
        .pay-badge { background: #e8f4fd; color: #2980b9; }
        .card-badge { background: #f3e5f5; color: var(--purple); font-style: italic; }

        .filter-container { background: #f0f4f8; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #dce3e8; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; background: #fff; padding: 12px; border-bottom: 2px solid #ddd; font-size: 0.85rem; }
        td { padding: 12px; border-bottom: 1px solid #eee; background: #fff; font-size: 0.9rem; }

        .total-container { margin-top: 25px; text-align: right; font-size: 1.6rem; font-weight: bold; color: var(--dark); padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .delete-btn { color: var(--danger); background: none; font-size: 1.2rem; }
        
        #total-amount { color: var(--success); }
    </style>
</head>
<body>

<div class="container">
    <h2>üí∞ Gestor Financeiro</h2>

    <div class="section">
        <h3>‚ûï Novo Lan√ßamento</h3>
        <div class="input-row">
            <div class="field-group" style="flex: 2;">
                <label>Descri√ß√£o</label>
                <input type="text" id="desc" placeholder="Ex: Farm√°cia">
            </div>
            <div class="field-group">
                <label>Valor (R$)</label>
                <input type="number" id="amount" placeholder="0.00" step="0.01">
            </div>
            <div class="field-group">
                <label>Data</label>
                <input type="date" id="date-input">
            </div>
        </div>
        <div class="input-row">
            <div class="field-group">
                <label>Categoria</label>
                <select id="category-input">
                    <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                    <option value="Educa√ß√£o">Educa√ß√£o</option>
                    <option value="Lazer">Lazer</option>
                    <option value="Moradia">Moradia</option>
                    <option value="Sa√∫de">Sa√∫de</option>
                    <option value="Transporte">Transporte</option>
                    <option value="Outros">Outros</option>
                </select>
            </div>
            <div class="field-group">
                <label>Forma de Pagamento</label>
                <select id="payment-input" onchange="toggleCardInput('payment-input', 'card-name-container')">
                    <option value="Dinheiro">Dinheiro</option>
                    <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                    <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
                    <option value="Pix">Pix</option>
                </select>
            </div>
            <div class="field-group" id="card-name-container">
                <label>Qual Cart√£o?</label>
                <select id="card-name">
                    <option value="Banco do Brasil">Banco do Brasil</option>
                    <option value="Bradesco">Bradesco</option>
                    <option value="C6 Bank">C6 Bank</option>
                    <option value="Caixa">Caixa</option>
                    <option value="Inter">Inter</option>
                    <option value="Ita√∫">Ita√∫</option>
                    <option value="Nubank">Nubank</option>
                    <option value="RecargaPay">RecargaPay</option>
                    <option value="Santander">Santander</option>
                    <option value="XP">XP</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>
        </div>
        <button id="add-btn">Salvar Registro</button>
    </div>

    <div class="filter-container">
        <h3>üîç Filtros</h3>
        <div class="input-row">
            <div class="field-group"><label>In√≠cio</label><input type="date" id="filter-start"></div>
            <div class="field-group"><label>Fim</label><input type="date" id="filter-end"></div>
            <div class="field-group">
                <label>Categoria</label>
                <select id="filter-category">
                    <option value="TODAS">Todas</option>
                    <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                    <option value="Educa√ß√£o">Educa√ß√£o</option>
                    <option value="Lazer">Lazer</option>
                    <option value="Moradia">Moradia</option>
                    <option value="Sa√∫de">Sa√∫de</option>
                    <option value="Transporte">Transporte</option>
                    <option value="Outros">Outros</option>
                </select>
            </div>
        </div>
        <div class="input-row">
            <div class="field-group">
                <label>Pagamento</label>
                <select id="filter-payment" onchange="toggleCardInput('filter-payment', 'filter-card-container')">
                    <option value="TODOS">Todos os M√©todos</option>
                    <option value="Dinheiro">Dinheiro</option>
                    <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                    <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
                    <option value="Pix">Pix</option>
                </select>
            </div>
            <div class="field-group" id="filter-card-container">
                <label>Cart√£o Espec√≠fico</label>
                <select id="filter-card-name">
                    <option value="TODOS">Todos os Cart√µes</option>
                    <option value="Banco do Brasil">Banco do Brasil</option>
                    <option value="Bradesco">Bradesco</option>
                    <option value="C6 Bank">C6 Bank</option>
                    <option value="Caixa">Caixa</option>
                    <option value="Inter">Inter</option>
                    <option value="Ita√∫">Ita√∫</option>
                    <option value="Nubank">Nubank</option>
                    <option value="RecargaPay">RecargaPay</option>
                    <option value="Santander">Santander</option>
                    <option value="XP">XP</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>
            <button class="btn-filter" onclick="applyFilters()">Filtrar</button>
            <button class="btn-clear" onclick="clearFilters()">Limpar</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Descri√ß√£o</th>
                <th>Categoria</th>
                <th>Pagamento</th>
                <th>Valor</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="expense-list"></tbody>
    </table>

    <div class="total-container">
        Total Filtrado: <span id="total-amount">R$ 0,00</span>
    </div>
</div>

<script>
    const expenseList = document.getElementById('expense-list');
    const totalDisplay = document.getElementById('total-amount');

    // Chave de armazenamento v10
    let expenses = JSON.parse(localStorage.getItem('my_expenses_v10')) || [];

    function toggleCardInput(selectId, containerId) {
        const select = document.getElementById(selectId);
        const container = document.getElementById(containerId);
        container.style.display = (select.value === "Cart√£o de Cr√©dito") ? "flex" : "none";
    }

    function render(dataToRender = expenses) {
        expenseList.innerHTML = '';
        let total = 0;

        const sortedData = [...dataToRender].sort((a, b) => new Date(b.date) - new Date(a.date));

        sortedData.forEach((expense) => {
            total += parseFloat(expense.amount);
            const dateObj = new Date(expense.date);
            const formattedDate = dateObj.toLocaleDateString('pt-BR', {timeZone: 'UTC'});

            const paymentInfo = expense.cardName 
                ? `<div><span class="badge pay-badge">${expense.payment}</span><br><span class="badge card-badge">üí≥ ${expense.cardName}</span></div>`
                : `<span class="badge pay-badge">${expense.payment}</span>`;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${formattedDate}</td>
                <td>${expense.desc}</td>
                <td><span class="badge cat-badge">${expense.category}</span></td>
                <td>${paymentInfo}</td>
                <td>R$ ${expense.amount.toFixed(2)}</td>
                <td><button class="delete-btn" onclick="removeExpense('${expense.id}')">‚úï</button></td>
            `;
            expenseList.appendChild(row);
        });

        totalDisplay.innerText = `R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    }

    function addExpense() {
        const desc = document.getElementById('desc').value;
        const amount = parseFloat(document.getElementById('amount').value);
        const date = document.getElementById('date-input').value;
        const category = document.getElementById('category-input').value;
        const payment = document.getElementById('payment-input').value;
        const cardName = document.getElementById('card-name').value;

        if (!desc || isNaN(amount) || !date) {
            alert("Preencha descri√ß√£o, valor e data.");
            return;
        }

        const newExpense = { 
            id: Date.now().toString(), 
            desc, amount, date, category, payment,
            cardName: payment === "Cart√£o de Cr√©dito" ? cardName : null
        };
        
        expenses.push(newExpense);
        localStorage.setItem('my_expenses_v10', JSON.stringify(expenses));
        
        // Limpar campos
        document.getElementById('desc').value = '';
        document.getElementById('amount').value = '';
        render();
    }

    function removeExpense(id) {
        expenses = expenses.filter(exp => exp.id !== id);
        localStorage.setItem('my_expenses_v10', JSON.stringify(expenses));
        applyFilters();
    }

    function applyFilters() {
        const start = document.getElementById('filter-start').value;
        const end = document.getElementById('filter-end').value;
        const cat = document.getElementById('filter-category').value;
        const pay = document.getElementById('filter-payment').value;
        const cardFilter = document.getElementById('filter-card-name').value;

        const filtered = expenses.filter(exp => {
            const matchDate = (!start || !end) || (exp.date >= start && exp.date <= end);
            const matchCat = (cat === 'TODAS' || exp.category === cat);
            const matchPay = (pay === 'TODOS' || exp.payment === pay);
            
            let matchCard = true;
            if (pay === 'Cart√£o de Cr√©dito' && cardFilter !== 'TODOS') {
                matchCard = exp.cardName === cardFilter;
            }

            return matchDate && matchCat && matchPay && matchCard;
        });

        render(filtered);
    }

    function clearFilters() {
        document.getElementById('filter-start').value = '';
        document.getElementById('filter-end').value = '';
        document.getElementById('filter-category').value = 'TODAS';
        document.getElementById('filter-payment').value = 'TODOS';
        document.getElementById('filter-card-name').value = 'TODOS';
        toggleCardInput('filter-payment', 'filter-card-container');
        render(expenses);
    }

    document.getElementById('add-btn').addEventListener('click', addExpense);
    render();
</script>

</body>
</html>